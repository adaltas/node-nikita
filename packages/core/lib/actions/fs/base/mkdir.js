// Generated by CoffeeScript 2.6.1
// # `nikita.fs.base.mkdir`

// Create a directory. Missing parent directories are created as required.

// ## Schema definitions
var definitions, errors, handler, utils;

definitions = {
  config: {
    type: 'object',
    properties: {
      'gid': {
        $ref: 'module://@nikitajs/core/lib/actions/fs/base/chown#/definitions/config/properties/gid'
      },
      'mode': {
        $ref: 'module://@nikitajs/core/lib/actions/fs/base/chmod#/definitions/config/properties/mode'
      },
      'target': {
        type: 'string',
        description: `Location of the directory to create.`
      },
      'uid': {
        $ref: 'module://@nikitajs/core/lib/actions/fs/base/chown#/definitions/config/properties/uid'
      }
    },
    required: ['target']
  }
};

// ## Handler
handler = async function({config}) {
  var err;
  if (typeof config.mode === 'number') {
    // Convert mode into a string
    config.mode = config.mode.toString(8).substr(-4);
  }
  try {
    return (await this.execute([`[ -d '${config.target}' ] && exit 17`, ['install', config.mode ? `-m '${config.mode}'` : void 0, config.uid ? `-o '${config.uid}'` : void 0, config.gid ? `-g '${config.gid}'` : void 0, `-d '${config.target}'`].join(' ')].join('\n')));
  } catch (error) {
    err = error;
    if (err.exit_code === 17) {
      err = errors.NIKITA_FS_MKDIR_TARGET_EEXIST({
        config: config
      });
    }
    throw err;
  }
};

// ## Exports
module.exports = {
  handler: handler,
  metadata: {
    argument_to_config: 'target',
    log: false,
    raw_output: true,
    definitions: definitions
  }
};

// ## Errors
errors = {
  NIKITA_FS_MKDIR_TARGET_EEXIST: function({config}) {
    return utils.error('NIKITA_FS_MKDIR_TARGET_EEXIST', ['fail to create a directory,', 'one already exists,', `location is ${JSON.stringify(config.target)}.`], {
      error_code: 'EEXIST',
      errno: -17,
      path: config.target_tmp || config.target, // Native Node.js api doesn't provide path
      syscall: 'mkdir'
    });
  }
};

// ## Dependencies
utils = require('../../../utils');
