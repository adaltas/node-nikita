// Generated by CoffeeScript 2.6.1
var mutate;

({mutate} = require('mixme'));

module.exports = {
  name: '@nikitajs/core/lib/plugins/metadata/disabled',
  hooks: {
    'nikita:schema': function({schema}) {
      return mutate(schema.definitions.metadata.properties, {
        disabled: {
          type: 'boolean',
          description: `Disable the execution of the current action  and consequently the
execution of its child actions.`,
          default: false
        }
      });
    },
    'nikita:action': function(action, handler) {
      var base;
      // Note, we dont enforce schema validation before it because
      // When a plugin a disabled, chances are that not all its property
      // where passed correctly and we don't want schema validation
      // to throw an error in such cases
      if ((base = action.metadata).disabled == null) {
        base.disabled = false;
      }
      if (action.metadata.disabled === true) {
        return null;
      } else {
        return handler;
      }
    }
  }
};
