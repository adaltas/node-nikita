{
    "componentChunkName": "component---src-templates-action-js",
    "path": "/current/actions/core/execute/",
    "result": {"data":{"page":{"slug":"/current/actions/core/execute/","edit_url":"https://github.com/adaltas/node-nikita/edit/master/packages/core/src/actions/execute/index.coffee.md","package":{"id":"daec4302-7771-5b7c-ad7c-702e3eb49237","keywords":["nikita","build","cli","deployment","automation","IaS","fs","install","ssh","system","task"]},"name":"execute","version":{"alias":"current"},"parent":{"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, \"Run a command locally or with ssh if \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"host\"), \" or \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"ssh\"), \" is provided.\"), mdx(\"h2\", {\n    \"id\": \"exit-codes\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#exit-codes\",\n    \"aria-label\": \"exit codes permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Exit codes\"), mdx(\"p\", null, \"The \\\"code\\\" property is important to determine whether an\\naction failed or succeed with or without modifications. An action is expected to\\nexecute successfully if the exit code match one of the value\\nin \\\"code\\\", by default \\\"0\\\". Otherwise, it is considered to have failed and an\\nerror is passed to the user callback. Sucessfull codes may or may not impact the\\nstatus, indicating or not a change of state.\"), mdx(\"p\", null, \"The normalized form of code is an object with 2 properties:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"true\"), \": indicating a change of state, returned \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"$status\"), \" is \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"true\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"false\"), \": indicating no change of state, returned \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"$status\"), \" is \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"false\"), \".\")), mdx(\"p\", null, \"The default value is: \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"{ true: [0], false: [] }\"), \".\"), mdx(\"p\", null, \"When code is an integer, it overwrite the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"true\"), \" property, for example:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-js\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"nikita\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"execute\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"code\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"command\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'exit 1'\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"config\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  assert\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"deepEqual\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"\\n    config\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"code\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token boolean\"\n  }, \"true\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token boolean\"\n  }, \"false\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")))), mdx(\"p\", null, \"When code is an array, the first element overwrite the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"true\"), \" property while\\nadditionnal elements overwrite the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"false\"), \" property:\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-js\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, \"nikita\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"execute\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"code\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"2\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"3\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"4\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"command\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'exit 1'\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token parameter\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"config\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=>\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  assert\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"deepEqual\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"\\n    config\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), \"code\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n    \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token boolean\"\n  }, \"true\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"1\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token boolean\"\n  }, \"false\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"2\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"3\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"4\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \";\")))), mdx(\"h2\", {\n    \"id\": \"output\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#output\",\n    \"aria-label\": \"output permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Output\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"$status\"), mdx(\"br\", {\n    parentName: \"li\"\n  }), \"Value is \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"true\"), \" if exit code equals on of the values of \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"code.true\"), \", \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"[0]\"), \" by default, \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"false\"), \" if\\nexit code equals on of the values of \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"code.false\"), \", \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"[]\"), \" by default.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"stdout\"), mdx(\"br\", {\n    parentName: \"li\"\n  }), \"Stdout value(s) unless \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"stdout\"), \" property is provided.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"stderr\"), mdx(\"br\", {\n    parentName: \"li\"\n  }), \"Stderr value(s) unless \", mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"stderr\"), \" property is provided.\")), mdx(\"h2\", {\n    \"id\": \"temporary-directory\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#temporary-directory\",\n    \"aria-label\": \"temporary directory permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Temporary directory\"), mdx(\"p\", null, \"A temporary directory is required under certain conditions. The action leverages\\nthe \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"tmpdir\"), \" plugins which is only activated when necessary. The conditions\\ninvolves the usage of \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"sudo\"), \", \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"chroot\"), \", \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"arch_chroot\"), \" or \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"env_export\"), \".\"), mdx(\"p\", null, \"For performance reason, consider declare the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"metadata.tmpdir\"), \" property in your\\nparent action to avoid the creation and removal of a tempory directory everytime\\nthe \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"execute\"), \" action is called.\"), mdx(\"h2\", {\n    \"id\": \"events\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#events\",\n    \"aria-label\": \"events permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Events\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"stdout\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"stdout_stream\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"stderr\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"code\", {\n    parentName: \"li\",\n    \"className\": \"language-text\"\n  }, \"stderr_stream\"))), mdx(\"h2\", {\n    \"id\": \"create-a-user-over-ssh\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#create-a-user-over-ssh\",\n    \"aria-label\": \"create a user over ssh permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Create a user over SSH\"), mdx(\"p\", null, \"This example create a user on a remote server with the \", mdx(\"code\", {\n    parentName: \"p\",\n    \"className\": \"language-text\"\n  }, \"useradd\"), \" command. It\\nprint the error message if the command failed or an information message if it\\nsucceed.\"), mdx(\"p\", null, \"An exit code equal to \\\"9\\\" defined by the \\\"code.false\\\" property indicates that\\nthe command is considered successfull but without any impact.\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-js\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"$status\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"await\"), \" nikita\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"execute\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"ssh\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" ssh\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"command\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'useradd myfriend'\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"code\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"[\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"0\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token number\"\n  }, \"9\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"]\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\nconsole\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"info\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token template-string\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token string\"\n  }, \"User was created: \"), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation\"\n  }, mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"${\"), \"$status\", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token interpolation-punctuation punctuation\"\n  }, \"}\")), mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"token template-punctuation string\"\n  }, \"`\")), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\")))), mdx(\"h2\", {\n    \"id\": \"run-a-command-with-bash\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#run-a-command-with-bash\",\n    \"aria-label\": \"run a command with bash permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Run a command with bash\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"js\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-js\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\"\n  }, mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"const\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"stdout\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \"=\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token keyword\"\n  }, \"await\"), \" nikita\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"execute\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"{\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"bash\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token boolean\"\n  }, \"true\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \",\"), \"\\n  \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token literal-property property\"\n  }, \"command\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token operator\"\n  }, \":\"), \" \", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token string\"\n  }, \"'env'\"), \"\\n\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"}\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\"), \"\\nconsole\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \".\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token function\"\n  }, \"info\"), mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \"(\"), \"stdout\", mdx(\"span\", {\n    parentName: \"code\",\n    \"className\": \"token punctuation\"\n  }, \")\")))), mdx(\"h2\", {\n    \"id\": \"hooks\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#hooks\",\n    \"aria-label\": \"hooks permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Hooks\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-text\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-text\"\n  }, \"on_action =\\n  after: [\\n    '@nikitajs/core/src/plugins/execute'\\n    '@nikitajs/core/src/plugins/ssh'\\n    '@nikitajs/core/src/plugins/tools/path'\\n  ]\\n  before: [\\n    '@nikitajs/core/src/plugins/metadata/schema'\\n    '@nikitajs/core/src/plugins/metadata/tmpdir'\\n  ]\\n  handler: ({config, metadata, ssh, tools: {find, path, walk}}) ->\\n    config.env ?= if not ssh and not config.env then process.env else {}\\n    env_export = if config.env_export? then config.env_export else !!ssh\\n    # Create the tmpdir if arch_chroot is activated\\n    if config.arch_chroot and config.arch_chroot_rootdir\\n      metadata.tmpdir ?= ({os_tmpdir, tmpdir}) ->\\n        # Note, Arch mount `/tmp` with tmpfs in memory\\n        # placing a file in the host fs will not expose it inside of chroot\\n        config.arch_chroot_tmpdir = path.join '/opt', tmpdir\\n        tmpdir = path.join config.arch_chroot_rootdir, config.arch_chroot_tmpdir\\n        sudo = (command) ->\\n          if utils.os.whoami(ssh) is 'root'\\n          then command\\n          else \\\"sudo #{command}\\\"\\n        command = [\\n          'set -e'\\n          sudo \\\"[ -w #{config.arch_chroot_rootdir} ] || exit 2;\\\"\\n          sudo \\\"mkdir -p #{tmpdir};\\\"\\n          sudo \\\"chmod 700 #{tmpdir};\\\"\\n        ].join '\\\\n'\\n        try\\n          await execProm ssh, command\\n        catch err\\n          throw errors.NIKITA_EXECUTE_ARCH_CHROOT_ROOTDIR_NOT_EXIST err: err, config: config if err.code is 2\\n          throw err\\n        target: tmpdir\\n    else if config.sudo or config.bash or (env_export and Object.keys(config.env).length)\\n      metadata.tmpdir ?= true\\n  \\non_result =\\n  before: '@nikitajs/core/src/plugins/ssh'\\n  handler: ({action: {config, metadata, ssh}}) ->\\n    # Only arch chroot manage tmpdir, otherwise it is handled by the plugin\\n    return unless config.arch_chroot and config.arch_chroot_rootdir\\n    # Disregard cleaning if tmpdir is a user defined function and if\\n    # the function failed to execute, see the on_action hook above.\\n    return if typeof metadata.tmpdir is 'function'\\n    sudo = (command) ->\\n      if utils.os.whoami(ssh) is 'root'\\n      then command\\n      else \\\"sudo #{command}\\\"\\n    command = [\\n      sudo \\\"rm -rf #{metadata.tmpdir}\\\"\\n    ].join '\\\\n'\\n    await execProm ssh, command\"))), mdx(\"h2\", {\n    \"id\": \"schema-definitions\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#schema-definitions\",\n    \"aria-label\": \"schema definitions permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Schema definitions\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-text\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-text\"\n  }, \"definitions =\\n  config:\\n    type: 'object'\\n    properties:\\n      'arch_chroot':\\n        type: ['boolean', 'string']\\n        description: '''\\n        Run this command inside a root directory with the arc-chroot command\\n        or any provided string, require the \\\"arch_chroot_rootdir\\\" option if activated.\\n        '''\\n      'bash':\\n        type: ['boolean', 'string']\\n        description: '''\\n        Serialize the command into a file and execute it with bash.\\n        '''\\n      'code':\\n        cast_code: true\\n        type: ['integer', 'string', 'array', 'object']\\n        properties:\\n          'true':\\n            type: 'array'\\n            items: type: 'integer'\\n            default: [0]\\n          'false':\\n            type: 'array'\\n            items: type: 'integer'\\n            default: []\\n        default: {}\\n        description: '''\\n        Valid exit code(s) returned by the command.\\n        '''\\n      'command':\\n        oneOf: [\\n          type: 'string'\\n        ,\\n          typeof: 'function'\\n        ]\\n        description: '''\\n        String, Object or array; Command to execute. A value provided as a\\n        function is interpreted as an action and will be called by forwarding\\n        the config object. The result is the expected to be the command\\n        to execute.\\n        '''\\n      'cwd':\\n        type: 'string'\\n        description: '''\\n        Current working directory from where to execute the command.\\n        '''\\n      'dirty':\\n        type: 'boolean'\\n        default: false\\n        description: '''\\n        Leave temporary files on the filesystem.\\n        '''\\n      'dry':\\n        type: 'boolean'\\n        description: '''\\n        Run the action without executing any real command.\\n        '''\\n      'env':\\n        type: 'object'\\n        description: '''\\n        Environment variables as key-value pairs. With local execution, it\\n        default to `process.env`. With remote execution over SSH, the accepted\\n        environment variables is determined by the AcceptEnv server setting\\n        and default to \\\"LANG,LC_*\\\". See the `env_export` property to get\\n        around this limitation.\\n        '''\\n        patternProperties: '': type: \\\"string\\\"\\n      'env_export':\\n        type: 'boolean'\\n        description: '''\\n        Write a temporary file which exports the the environment variables\\n        defined in the `env` property. The value is always `true` when\\n        environment variables must be used with SSH.\\n        '''\\n      'format':\\n        type: 'string'\\n        enum: ['json', 'yaml']\\n        description: '''\\n        Convert the stdout to a Javascript value or object.\\n        '''\\n      'gid':\\n        type: 'integer'\\n        description: '''\\n        Unix group id.\\n        '''\\n      'stdio':\\n        # Schema coercion from string, without is\\n        # oneOf: [\\n        #   $ref: '#/definitions/stdio'\\n        # ,\\n        #   type: 'array'\\n        #   items: $ref: '#/definitions/stdio'\\n        # ]\\n        type: 'array'\\n        items:\\n          $ref: '#/definitions/stdio'\\n        description: '''\\n        Configure the pipes that are established between the parent and\\n        child process.\\n        '''\\n      'stdin':\\n        instanceof: 'Object' # must be `stream.Writable`\\n        description: '''\\n        Readable EventEmitter in which the standard input is piped from.\\n        '''\\n      'stdin_log':\\n        type: 'boolean'\\n        default: true\\n        description: '''\\n        Log the executed command of type stdin, default is `true`.\\n        '''\\n      'stdout':\\n        instanceof: 'Object' # must be `stream.Writable`\\n        description: '''\\n        Writable EventEmitter in which the standard output of executed\\n        commands will be piped.\\n        '''\\n      'stdout_return':\\n        type: 'boolean'\\n        default: true\\n        description: '''\\n        Return the stderr content in the output, default is `true`.  It is\\n        preferable to set this property to `false` and to use the `stdout`\\n        property when expecting a large stdout output.\\n        '''\\n      'stdout_log':\\n        type: 'boolean'\\n        default: true\\n        description: '''\\n        Pass stdout output to the logs of type \\\"stdout_stream\\\", default is\\n        `true`.\\n        '''\\n      'stdout_trim':\\n        type: 'boolean'\\n        default: false\\n        description: '''\\n        Trim the stdout output.\\n        '''\\n      'stderr':\\n        instanceof: 'Object' # must be `stream.Writable`\\n        description: '''\\n        Writable EventEmitter in which the standard error output of executed\\n        command will be piped.\\n        '''\\n      'stderr_return':\\n        type: 'boolean'\\n        default: true\\n        description: '''\\n        Return the stderr content in the output, default is `true`. It is\\n        preferable to set this property to `false` and to use the `stderr`\\n        property when expecting a large stderr output.\\n        '''\\n      'stderr_log':\\n        type: 'boolean'\\n        default: true\\n        description: '''\\n        Pass stdout output to the logs of type \\\"stdout_stream\\\", default is\\n        `true`.\\n        '''\\n      'stderr_trim':\\n        type: 'boolean'\\n        default: false\\n        description: '''\\n        Trim the stderr output.\\n        '''\\n      'sudo':\\n        type: 'boolean'\\n        # default: false\\n        description: '''\\n        Run a command as sudo, desactivated if user is \\\"root\\\".\\n        '''\\n      'target':\\n        type: 'string'\\n        description: '''\\n        Temporary path storing the script, only apply with the `bash` and\\n        `arch_chroot` properties, always disposed once executed. Unless\\n        provided, the default location is `{metadata.tmpdir}/{string.hash\\n        config.command}`. See the `tmpdir` plugin for additionnal information.\\n        '''\\n      'trap':\\n        type: 'boolean'\\n        default: false\\n        description: '''\\n        Exit immediately if a commands inside a script exits with a non-zero\\n        exit status, add the `set -e` option to your script.\\n        '''\\n      'trim':\\n        type: 'boolean'\\n        default: false\\n        description: '''\\n        Trim both the stdout and stderr outputs.\\n        '''\\n      'uid':\\n        type: 'integer'\\n        description: '''\\n        Unix user id.\\n        '''\\n    dependencies:\\n      arch_chroot:\\n        properties:\\n          'arch_chroot_rootdir':\\n            type: 'string'\\n            description: '''\\n            Path to the mount point corresponding to the root directory, required\\n            if the \\\"arch_chroot\\\" option is activated.\\n            '''\\n        required: ['arch_chroot_rootdir']\\n    required: ['command']\\n  # see https://nodejs.org/api/child_process.html#optionsstdio\\n  stdio:\\n    oneOf: [\\n      enum: [\\n        'pipe', 'overlapped', 'ignore', 'inherit'\\n      ]\\n      type: 'string'\\n    ,\\n      enum: [\\n        0, 1, 2\\n      ]\\n      type: 'integer'\\n    ]\\n      \"))), mdx(\"h2\", {\n    \"id\": \"handler\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#handler\",\n    \"aria-label\": \"handler permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Handler\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-text\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-text\"\n  }, \"handler = ({config, metadata, parent, tools: {dig, find, log, path, walk}, ssh}) ->\\n  # Validate parameters\\n  config.mode ?= 0o500\\n  config.command = await @call config, config.command if typeof config.command is 'function'\\n  config.bash = 'bash' if config.bash is true\\n  config.arch_chroot = 'arch-chroot' if config.arch_chroot is true\\n  config.command = \\\"set -e\\\\n#{config.command}\\\" if config.command and config.trap\\n  config.command_original = \\\"#{config.command}\\\"\\n  # sudo = await find ({config: {sudo}}) -> sudo\\n  dry = await find ({config: {dry}}) -> dry\\n  # TODO move next 2 lines this to schema or on_action ?\\n  throw Error \\\"Incompatible properties: bash, arch_chroot\\\" if ['bash', 'arch_chroot'].filter((k) -> config[k]).length > 1\\n  # Environment variables are merged with parent\\n  # env = merge {}, ...await walk ({config: {env}}) -> env\\n  # Serialize env in a sourced file\\n  env_export = if config.env_export? then config.env_export else !!ssh\\n  if env_export and Object.keys(config.env).length\\n    env_export_content = (\\n      \\\"export #{k}=#{utils.string.escapeshellarg v}\\\\n\\\" for k, v of config.env\\n    ).join '\\\\n'\\n    env_export_hash = utils.string.hash env_export_content\\n  # Guess current username\\n  current_username = utils.os.whoami(ssh)\\n  # Sudo\\n  if config.sudo\\n    if current_username is 'root'\\n      config.sudo = false\\n    else\\n      config.bash = 'bash' unless ['bash', 'arch_chroot'].some (k) -> config[k]\\n  # User substitution\\n  # Determines if writing is required and eventually convert uid to username\\n  if config.uid and current_username isnt 'root' and not /\\\\d/.test \\\"#{config.uid}\\\"\\n    {stdout} = await @execute \\\"awk -v val=#{config.uid} -F \\\":\\\" '$3==val{print $1}' /etc/passwd`\\\", (err, {stdout}) ->\\n    config.uid = stdout.trim()\\n    config.bash = 'bash' unless config.bash or config.arch_chroot\\n  if env_export and Object.keys(config.env).length\\n    env_export_hash = utils.string.hash env_export_content\\n    env_export_target = path.join metadata.tmpdir, env_export_hash\\n    config.command = \\\"source #{env_export_target}\\\\n#{config.command}\\\"\\n    log message: \\\"Writing env export to #{JSON.stringify env_export_target}\\\", level: 'INFO'\\n    await @fs.base.writeFile\\n      $sudo: config.sudo\\n      content: env_export_content\\n      mode: 0o500\\n      target: env_export_target\\n      uid: config.uid\\n  if config.arch_chroot\\n    # Note, with arch_chroot enabled, \\n    # arch_chroot_rootdir `/mnt` gave birth to\\n    # tmpdir `/mnt/tmpdir/nikita-random-path`\\n    # and target is inside it\\n    command = config.command\\n    if typeof target isnt 'string'\\n      target_in = path.join config.arch_chroot_tmpdir, \\\"execute-arch_chroot-#{utils.string.hash config.command}\\\"\\n      target = path.join config.arch_chroot_rootdir, target_in\\n    # target = \\\"#{metadata.tmpdir}/#{utils.string.hash config.command}\\\" if typeof config.target isnt 'string'\\n    log message: \\\"Writing arch-chroot script to #{JSON.stringify target}\\\", level: 'INFO'\\n    config.command = \\\"#{config.arch_chroot} #{config.arch_chroot_rootdir} bash #{target_in}\\\"\\n    await @fs.base.writeFile\\n      $sudo: config.sudo\\n      target: \\\"#{target}\\\"\\n      content: \\\"#{command}\\\"\\n      mode: config.mode\\n  # Write script\\n  else if config.bash\\n    command = config.command\\n    if typeof target isnt 'string'\\n      target = path.join metadata.tmpdir, \\\"execute-bash-#{utils.string.hash config.command}\\\"\\n    log message: \\\"Writing bash script to #{JSON.stringify target}\\\", level: 'INFO'\\n    config.command = \\\"#{config.bash} #{target}\\\"\\n    config.command = \\\"su - #{config.uid} -c '#{config.command}'\\\" if config.uid\\n    # Note, rm cannot be remove with arch_chroot enabled\\n    config.command += \\\";code=`echo $?`; rm '#{target}'; exit $code\\\" unless config.dirty\\n    await @fs.base.writeFile\\n      $sudo: config.sudo\\n      content: command\\n      mode: config.mode\\n      target: target\\n      uid: config.uid\\n  if config.sudo\\n    config.command = \\\"sudo #{config.command}\\\"\\n  # Execute\\n  new Promise (resolve, reject) ->\\n    log message: config.command_original, type: 'stdin', level: 'INFO' if config.stdin_log\\n    result =\\n      $status: false\\n      stdout: []\\n      stderr: []\\n      code: null\\n      command: config.command_original\\n    return resolve result if config.dry\\n    child = exec config,\\n      ssh: ssh\\n      env: config.env\\n    # Note, child[stdin|stdout|stderr] are undefined\\n    # when option stdio is set to 'inherit'\\n    config.stdin.pipe child.stdin if config.stdin and child.stdin\\n    child.stdout.pipe config.stdout, end: false if config.stdout and child.stdout\\n    child.stderr.pipe config.stderr, end: false if config.stderr and child.stderr\\n    stdout_stream_open = stderr_stream_open = false\\n    if child.stdout and (config.stdout_return or config.stdout_log)\\n      child.stdout.on 'data', (data) ->\\n        stdout_stream_open = true if config.stdout_log\\n        log message: data, type: 'stdout_stream' if config.stdout_log\\n        if config.stdout_return\\n          if Array.isArray result.stdout # A string once `exit` is called\\n            result.stdout.push data\\n          else console.warn [\\n            'NIKITA_EXECUTE_STDOUT_INVALID:'\\n            'stdout coming after child exit,'\\n            \\\"got #{JSON.stringify data.toString()},\\\"\\n            'this is embarassing and we never found how to catch this bug,'\\n            'we would really enjoy some help to replicate or fix this one.'\\n          ].join ' '\\n    if child.stderr and (config.stderr_return or config.stderr_log)\\n      child.stderr.on 'data', (data) ->\\n        stderr_stream_open = true if config.stderr_log\\n        log message: data, type: 'stderr_stream' if config.stderr_log\\n        if config.stderr_return\\n          if Array.isArray result.stderr # A string once `exit` is called\\n            result.stderr.push data\\n          else console.warn [\\n            'NIKITA_EXECUTE_STDERR_INVALID:'\\n            'stderr coming after child exit,'\\n            \\\"got #{JSON.stringify data.toString()},\\\"\\n            'this is embarassing and we never found how to catch this bug,'\\n            'we would really enjoy some help to replicate or fix this one.'\\n          ].join ' '\\n    child.on \\\"exit\\\", (code) ->\\n      log message: \\\"Command exit with status: #{code}\\\", level: 'DEBUG'\\n      result.code = code\\n      # Give it some time because the \\\"exit\\\" event is sometimes called\\n      # before the \\\"stdout\\\" \\\"data\\\" event when running `npm test`\\n      setImmediate ->\\n        log message: null, type: 'stdout_stream' if stdout_stream_open and config.stdout_log\\n        log message: null, type: 'stderr_stream' if  stderr_stream_open and config.stderr_log\\n        result.stdout = result.stdout.map((d) -> d.toString()).join('')\\n        result.stdout = result.stdout.trim() if config.trim or config.stdout_trim\\n        result.stderr = result.stderr.map((d) -> d.toString()).join('')\\n        result.stderr = result.stderr.trim() if config.trim or config.stderr_trim\\n        if config.format and config.code.true.indexOf(code) isnt -1\\n          result.data = switch config.format\\n            when 'json' then JSON.parse result.stdout\\n            when 'yaml' then yaml.load result.stdout\\n        log message: result.stdout, type: 'stdout' if result.stdout and result.stdout isnt '' and config.stdout_log\\n        log message: result.stderr, type: 'stderr' if result.stderr and result.stderr isnt '' and config.stderr_log\\n        if child.stdout and config.stdout\\n          child.stdout.unpipe config.stdout\\n        if child.stderr and config.stderr\\n          child.stderr.unpipe config.stderr\\n        if config.code.true.indexOf(code) is -1 and config.code.false.indexOf(code) is -1\\n          log \\n            message: [\\n              'An unexpected exit code was encountered,'\\n              'using relax mode,' if metadata.relax\\n              \\\"command is #{JSON.stringify utils.string.max config.command_original, 50},\\\"\\n              \\\"got #{JSON.stringify result.code}\\\"\\n              \\\"instead of #{JSON.stringify config.code}.\\\"\\n            ].filter( (line) -> !!line).join ' '\\n            level: if metadata.relax then 'INFO' else 'ERROR'\\n          return reject utils.error 'NIKITA_EXECUTE_EXIT_CODE_INVALID', [\\n            'an unexpected exit code was encountered,'\\n            'using relax mode,' if metadata.relax\\n            \\\"command is #{JSON.stringify utils.string.max config.command_original, 50},\\\"\\n            \\\"got #{JSON.stringify result.code}\\\"\\n            \\\"instead of #{JSON.stringify config.code}.\\\"\\n          ], {...result, exit_code: code}\\n        if config.code.false.indexOf(code) is -1\\n          result.$status = true\\n        else\\n          log message: \\\"Skip exit code `#{code}`\\\", level: 'INFO'\\n        resolve result\"))), mdx(\"h2\", {\n    \"id\": \"exports\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#exports\",\n    \"aria-label\": \"exports permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Exports\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-text\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-text\"\n  }, \"module.exports =\\n  handler: handler\\n  hooks:\\n    on_action: on_action\\n    on_result: on_result\\n  metadata:\\n    argument_to_config: 'command'\\n    definitions: definitions\"))), mdx(\"h2\", {\n    \"id\": \"errors\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#errors\",\n    \"aria-label\": \"errors permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Errors\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-text\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-text\"\n  }, \"errors =\\n  NIKITA_EXECUTE_ARCH_CHROOT_ROOTDIR_NOT_EXIST: ({err, config}) ->\\n    utils.error 'NIKITA_EXECUTE_ARCH_CHROOT_ROOTDIR_NOT_EXIST', [\\n      'directory defined by `config.arch_chroot_rootdir` must exist,'\\n      \\\"location is #{JSON.stringify config.arch_chroot_rootdir}.\\\"\\n    ],\\n      exit_code: err.code\\n      stdout: err.stdout\\n      stderr: err.stderr\"))), mdx(\"h2\", {\n    \"id\": \"dependencies\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#dependencies\",\n    \"aria-label\": \"dependencies permalink\",\n    \"className\": \"anchor before\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  }))), \"Dependencies\"), mdx(\"div\", {\n    \"className\": \"gatsby-highlight\",\n    \"data-language\": \"text\"\n  }, mdx(\"pre\", {\n    parentName: \"div\",\n    \"className\": \"language-text\"\n  }, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-text\"\n  }, \"exec = require 'ssh2-exec'\\nexecProm = require 'ssh2-exec/promise'\\nfs = require 'ssh2-fs'\\nyaml = require 'js-yaml'\\nutils = require '../../utils'\"))));\n}\n;\nMDXContent.isMDXComponent = true;","tableOfContents":{"items":[{"url":"#nikitaexecute","title":"nikita.execute","items":[{"url":"#exit-codes","title":"Exit codes"},{"url":"#output","title":"Output"},{"url":"#temporary-directory","title":"Temporary directory"},{"url":"#events","title":"Events"},{"url":"#create-a-user-over-ssh","title":"Create a user over SSH"},{"url":"#run-a-command-with-bash","title":"Run a command with bash"},{"url":"#hooks","title":"Hooks"},{"url":"#schema-definitions","title":"Schema definitions"},{"url":"#handler","title":"Handler"},{"url":"#exports","title":"Exports"},{"url":"#errors","title":"Errors"},{"url":"#dependencies","title":"Dependencies"}]}]},"excerpt":"nikita.execute Run a command locally or with ssh if  host  or  ssh  is provided. Exit codes The \"code\" property is important to determine whether an\naction failed or succeed with or without modificat…"}}},"pageContext":{}},
    "staticQueryHashes": ["2288906906","393869461"]}